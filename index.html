<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>Market Expansion : Leads Wanonniwat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100vh; width: 100vw; }
    .legend {
      position: absolute; bottom: 16px; left: 16px;
      background: white; padding: 14px 16px; border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,.15); font-family: sans-serif; font-size: 16px;
      min-width: 240px;
    }
    .legend .row { display: flex; align-items: center; gap: 8px; margin: 6px 0; }
    .dot { width: 14px; height: 14px; border-radius: 50%; display: inline-block; }
    .dot.red { background: #d00; }
    .dot.blue { background: #2a62ff; }
    .dot.green { background: #2ecc71; }

    .reach {
      position: absolute;
      top: 16px;
      left: 16px;
      background: linear-gradient(135deg, #ffffff, #f9fbff);
      padding: 16px 20px;
      border-radius: 14px;
      border: 1px solid #dce3f0;
      box-shadow: 0 4px 16px rgba(0,0,0,.15);
      font-family: "Segoe UI", sans-serif;
      font-size: 15px;
      min-width: 380px;
    }
    .reach .title { font-weight: 700; font-size: 16px; margin-bottom: 10px; color: #2c3e50; border-bottom: 2px solid #4a90e2; padding-bottom: 6px; }
    .reach .row { display: flex; flex-direction: column; margin: 8px 0; }
    .reach .label { display: flex; justify-content: space-between; margin-bottom: 4px; }
    .reach .bar { height: 10px; background: #e0e6f5; border-radius: 5px; overflow: hidden; }
    .reach .bar span { display: block; height: 100%; background: linear-gradient(90deg, #4a90e2, #50c9ce); }

    /* Date Filter */
    .filterbox { 
      background: linear-gradient(135deg, #ffffff, #f7fffb); 
      padding: 14px 16px; 
      border-radius: 14px; 
      border: 1px solid #cfe9db; 
      box-shadow: 0 4px 16px rgba(0,0,0,.15);
      font-family: "Segoe UI", sans-serif; font-size: 14px; min-width: 320px;
    }
    .filterbox .title { font-weight: 700; font-size: 16px; margin-bottom: 10px; color: #1f5135; border-bottom: 2px solid #6fd3a7; padding-bottom: 6px; }
    .filterbox .row { display: grid; grid-template-columns: auto 1fr; gap: 8px 10px; align-items: center; margin-bottom: 8px; }
    .filterbox label { white-space: nowrap; }
    .filterbox input[type="date"] { padding: 6px 8px; border: 1px solid #d3e6dc; border-radius: 8px; }
    .filterbox .actions { display: flex; gap: 8px; }
    .filterbox button { 
      padding: 8px 12px; border-radius: 10px; border: 1px solid #bfe8d3; cursor: pointer; background: #e9fff5;
    }
    .filterbox button:hover { filter: brightness(0.98); }
    .filterbox .stat { margin-top: 8px; font-size: 13px; color: #1f5135; }

    /* Sales summary (under filter) */
    .salesbox { 
      background: linear-gradient(135deg, #ffffff, #fffaf5);
      padding: 16px 20px;
      border-radius: 14px;
      border: 1px solid #f0dcc3;
      box-shadow: 0 4px 16px rgba(0,0,0,.15);
      font-family: "Segoe UI", sans-serif;
      font-size: 15px;
      min-width: 320px;
      margin-top: 10px; 
    }
    .salesbox .title { font-weight: 700; font-size: 16px; margin-bottom: 10px; color: #6b3f00; border-bottom: 2px solid #ffb257; padding-bottom: 6px; }
    .salesbox .row { display: flex; justify-content: space-between; align-items: center; background: #fff4e5; margin: 6px 0; padding: 8px 12px; border-radius: 10px; }
    .salesbox .value { font-weight: 700; font-size: 18px; color: #7a4d00; }

    /* Close Won Summary (fixed) */
    .wonbox{
      background: linear-gradient(135deg,#ffffff,#f3f7ff);
      padding:16px 20px;
      border-radius:14px;
      border:1px solid #dbe4ff;
      box-shadow:0 4px 16px rgba(0,0,0,.12);
      font-family:"Segoe UI",sans-serif;
      font-size:15px;
      min-width:320px;
      margin-top:10px;
    }
    .wonbox .title{ font-weight:700; font-size:16px; margin-bottom:10px; color:#1e3a8a; border-bottom:2px solid #93c5fd; padding-bottom:6px; }
    .wonbox .row{ display:flex; justify-content:space-between; align-items:center; background:#eef4ff; margin:6px 0; padding:8px 12px; border-radius:10px; }
    .wonbox .value{ font-weight:700; font-size:18px; color:#1e3a8a; }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // ===== Branch (fixed) =====
    const branch = {
      name: "‡∏™‡∏≤‡∏Ç‡∏≤ ‡∏ß‡∏≤‡∏ô‡∏£‡∏ô‡∏¥‡∏ß‡∏≤‡∏™",
      lat: 17.62932338805625,
      lng: 103.76765900596575,
      radius_m: 80000
    };

    // ===== Market Size (‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß) =====
    const MARKET_SIZE = {
      "‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£": 102,
      "‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨": 40
    };

    // ===== Data =====
    const greenData = [
      {"name":"‡∏õ‡∏±‡πä‡∏°‡∏≠‡∏∏‡∏ó‡∏±‡∏¢‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£","date":"2025-07-16","DS":9000,"G91":2500,"G95":2500,"supplier":"PT,‡πÑ‡∏ó‡∏¢‡∏£‡∏∏‡πà‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏á","lat":17.765329676058276,"lng":103.81967818209542,"amphoe":"‡∏Ñ‡∏≥‡∏ï‡∏≤‡∏Å‡∏•‡πâ‡∏≤","province":"‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£","resource":"","sender":"‡∏û‡∏µ‡πà‡∏à‡∏∏‡πà‡∏ô","note":"","BU":"ST"},
      {"name":"‡∏õ‡∏±‡πâ‡∏°‡∏´‡∏ô‡∏≠‡∏á‡∏Ñ‡∏≤‡∏¢‡πÑ‡∏ó‡∏¢‡∏£‡∏∏‡πà‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏á (‡∏´‡∏à‡∏Å.‡∏´‡∏ô‡∏≠‡∏á‡∏Ñ‡∏≤‡∏¢‡πÑ‡∏ó‡∏¢‡∏£‡∏∏‡πà‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏á)","date":"2025-07-16","DS":0,"G91":0,"G95":0,"supplier":"‡∏õ‡∏±‡πâ‡∏°‡∏´‡∏ô‡∏≠‡∏á‡∏Ñ‡∏≤‡∏¢‡πÑ‡∏ó‡∏¢‡∏£‡∏∏‡πà‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏á","lat":18.020289696607946,"lng":103.70718204106291,"amphoe":"‡∏û‡∏£‡πÄ‡∏à‡∏£‡∏¥‡∏ç","province":"‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨","resource":"‡∏°‡∏µ‡πÄ‡∏ó‡∏•‡πÄ‡∏•‡∏≠‡∏£‡πå 3 ‡∏´‡∏≤‡∏á 1 ‡∏´‡∏±‡∏ß‡∏•‡∏≤‡∏Å / 10 ‡∏•‡πâ‡∏≠ 3 / ‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå 1","sender":"‡∏û‡∏µ‡πà‡πÇ‡∏Å‡πâ","note":"","BU":"KN"},
      {"name":"‡∏õ‡∏±‡πâ‡∏°‡πÄ‡∏ó‡∏û‡∏õ‡∏£‡∏≤‡∏ì‡∏µ (‡∏´‡∏à‡∏Å.‡πÄ‡∏ó‡∏û‡∏õ‡∏£‡∏≤‡∏ì‡∏µ 1969)","date":"2025-07-16","DS":8000,"G91":0,"G95":4000,"supplier":"‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå","lat":17.943663515847685,"lng":104.0312431532645,"amphoe":"‡∏ö‡∏∂‡∏á‡πÇ‡∏Ç‡∏á‡∏´‡∏•‡∏á","province":"‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨","resource":"‡∏£‡∏±‡∏ö‡∏Å‡∏±‡∏ö‡πÄ‡∏ó‡∏•‡πÄ‡∏•‡∏≠‡∏£‡πå","sender":"‡∏û‡∏µ‡πà‡πÇ‡∏Å‡πâ","note":"","BU":"KN"},
      {"name":"‡∏õ‡∏ï‡∏ó.‡∏î‡∏á‡∏°‡∏∞‡πÑ‡∏ü (‡∏´‡∏à‡∏Å.‡πÄ‡∏ó‡∏ß‡∏¥‡∏ô‡∏õ‡∏¥‡πÇ‡∏ï‡∏£‡πÄ‡∏•‡∏µ‡∏¢‡∏°)","date":"2025-07-17","DS":0,"G91":0,"G95":0,"supplier":"‡∏õ‡∏ï‡∏ó ‡∏î‡∏á‡∏°‡∏∞‡πÑ‡∏ü","lat":17.277844877801485,"lng":103.9918417244141,"amphoe":"‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£","province":"‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£","resource":"","sender":"‡∏û‡∏µ‡πà‡∏à‡∏∏‡πà‡∏ô","note":"","BU":"ST"}
    ];
    const blueData = [
      {"name":"‡∏õ‡∏±‡πä‡∏°‡∏û‡∏¥‡∏ä‡∏±‡∏¢‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£","date":"2025-07-15","DS":6000,"G91":0,"G95":200,"supplier":"‡πÑ‡∏ó‡∏¢‡∏£‡∏∏‡πà‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏á‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨","lat":17.86715478819837,"lng":103.59521899559262,"amphoe":"‡∏ö‡πâ‡∏≤‡∏ô‡∏°‡πà‡∏ß‡∏á","province":"‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£","resource":"","sender":"‡∏û‡∏µ‡πà‡∏à‡∏∏‡πà‡∏ô","note":"‡∏ñ‡∏±‡∏á 200 ‡∏•‡∏¥‡∏ï‡∏£ 2 ‡∏ñ‡∏±‡∏á","BU":"ST"},
      {"name":"‡∏õ‡∏±‡πä‡∏°‡πÉ‡∏à‡∏î‡∏µ ‡∏ö‡πà‡∏≠‡πÅ‡∏Å‡πâ‡∏ß‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£","date":"2025-07-15","DS":18000,"G91":4000,"G95":4000,"supplier":"‡∏®‡∏£‡∏µ‡∏û‡∏•‡∏±‡∏á","lat":17.866426366070954,"lng":103.59515145326274,"amphoe":"‡∏ö‡πâ‡∏≤‡∏ô‡∏°‡πà‡∏ß‡∏á","province":"‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£","resource":"‡πÄ‡∏ó‡∏•‡πÄ‡∏•‡∏≠‡∏£‡πå‡∏™‡πà‡∏á","sender":"‡∏û‡∏µ‡πà‡∏ï‡πâ‡∏ô","note":"","BU":"ST"},
      {"name":"‡∏õ‡∏±‡πä‡∏°‡∏ô‡∏±‡∏ô‡∏°‡∏¥‡∏ô‡∏¥‡∏°‡∏≤‡∏£‡πå‡∏ó","date":"2025-07-15","DS":3000,"G91":0,"G95":500,"supplier":"‡πÑ‡∏ó‡∏¢‡∏£‡∏∏‡πà‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏á","lat":17.925056103979696,"lng":103.66866826675891,"amphoe":"‡∏ö‡πâ‡∏≤‡∏ô‡∏°‡πà‡∏ß‡∏á","province":"‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£","resource":"","sender":"‡∏û‡∏µ‡πà‡∏ï‡πâ‡∏ô","note":"‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î / ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏£‡∏≤‡∏™‡∏π‡πâ‡πÑ‡∏î‡πâ DS ‡∏ã‡∏∑‡πâ‡∏≠‡∏•‡∏¥‡∏ï‡∏£‡∏•‡∏∞ 32.00","BU":"ST"},
      {"name":"‡∏õ‡∏±‡πâ‡∏°‡∏™‡∏°‡∏û‡∏£‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤ ‡∏£‡∏±‡∏ö‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå","date":"2025-07-15","DS":500,"G91":0,"G95":500,"supplier":"‡πÑ‡∏ó‡∏¢‡∏£‡∏∏‡πà‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏á","lat":17.957674794286323,"lng":103.68048112442985,"amphoe":"‡∏û‡∏£‡πÄ‡∏à‡∏£‡∏¥‡∏ç","province":"‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨","resource":"","sender":"‡∏û‡∏µ‡πà‡πÇ‡∏Å‡πâ","note":"","BU":"KN"},
      {"name":"‡∏õ‡∏±‡πä‡∏°‡∏ä‡∏∏‡∏°‡∏ä‡∏ô‡∏™‡∏≤‡∏ò‡∏¥‡∏ï‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î ‡∏ö‡πâ‡∏≤‡∏ô‡∏û‡∏≠‡∏Å‡πÉ‡∏´‡∏ç‡πà","date":"2025-07-15","DS":4000,"G91":0,"G95":2000,"supplier":"","lat":17.858803949327505,"lng":103.71931080908715,"amphoe":"‡∏Ñ‡∏≥‡∏ï‡∏≤‡∏Å‡∏•‡πâ‡∏≤","province":"‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£","resource":"","sender":"‡∏û‡∏µ‡πà‡∏à‡∏∏‡πà‡∏ô","note":"","BU":"ST"},
      {"name":"‡∏õ‡∏±‡πâ‡∏°‡πÑ‡∏û‡∏®‡∏≤‡∏•‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ ‡∏≠.‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨","date":"2025-07-16","DS":9000,"G91":5000,"G95":5000,"supplier":"‡∏´‡∏ô‡∏≠‡∏á‡∏Ñ‡∏≤‡∏¢‡πÑ‡∏ó‡∏¢‡∏£‡∏∏‡πà‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏á","lat":18.275102836751245,"lng":103.8533200109426,"amphoe":"‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨","province":"‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨","resource":"","sender":"‡∏û‡∏µ‡πà‡πÇ‡∏Å‡πâ","note":"","BU":"KN"},
      {"name":"‡∏õ‡∏±‡πâ‡∏°‡∏™‡∏¥‡∏£‡∏¥‡∏ß‡∏±‡∏í‡∏ô‡πå","date":"2025-07-16","DS":3000,"G91":0,"G95":500,"supplier":"‡∏ä.‡∏ß‡∏¥‡∏ö‡∏π‡∏•‡∏¢‡πå(‡∏û‡∏£‡πÄ‡∏à‡∏£‡∏¥‡∏ç)","lat":18.179102382652673,"lng":103.89704795327019,"amphoe":"‡πÄ‡∏ã‡∏Å‡∏≤","province":"‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨","resource":"","sender":"‡∏û‡∏µ‡πà‡πÇ‡∏Å‡πâ","note":"","BU":"KN"},
      {"name":"‡∏õ‡∏±‡πâ‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á99","date":"2025-07-16","DS":0,"G91":0,"G95":0,"supplier":"‡∏´‡∏ô‡∏≠‡∏á‡∏Ñ‡∏≤‡∏¢‡πÑ‡∏ó‡∏¢‡∏£‡∏∏‡πà‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏á","lat":18.105442849515683,"lng":103.84663706676317,"amphoe":"‡∏®‡∏£‡∏µ‡∏ß‡∏¥‡πÑ‡∏•","province":"‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨","resource":"","sender":"‡∏û‡∏µ‡πà‡πÇ‡∏Å‡πâ","note":"‡∏£‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏Å‡∏±‡∏ö‡∏´‡∏ô‡∏≠‡∏á‡∏Ñ‡∏≤‡∏¢‡∏£‡∏∏‡πà‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á 3 ‡∏™‡∏≤‡∏Ç‡∏≤","BU":"KN"},
      {"name":"‡∏õ‡∏±‡πä‡∏°‡∏õ‡πà‡∏≤‡∏ô‡∏ï‡∏∞‡∏ß‡∏±‡∏ô","date":"2025-07-16","DS":4000,"G91":0,"G95":500,"supplier":"‡∏£‡∏µ‡∏û‡∏•‡∏±‡∏á","lat":17.765919023891154,"lng":103.81766172442532,"amphoe":"‡∏Ñ‡∏≥‡∏ï‡∏≤‡∏Å‡∏•‡πâ‡∏≤","province":"‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£","resource":"","sender":"‡∏û‡∏µ‡πà‡∏à‡∏∏‡πà‡∏ô","note":"","BU":"ST"},
      {"name":"‡∏õ‡∏±‡πâ‡∏°‡∏ö‡πâ‡∏≤‡∏ô‡∏ô‡∏≤‡πÅ‡∏™‡∏á","date":"2025-07-16","DS":0,"G91":0,"G95":0,"supplier":"‡∏ß‡∏¥‡∏ö‡∏π‡∏•‡∏¢‡πå(‡∏û‡∏£‡πÄ‡∏à‡∏£‡∏¥‡∏ç)","lat":18.116237525670297,"lng":103.86627256676341,"amphoe":"‡∏®‡∏£‡∏µ‡∏ß‡∏¥‡πÑ‡∏•","province":"‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨","resource":"","sender":"‡∏û‡∏µ‡πà‡πÇ‡∏Å‡πâ","note":"","BU":"KN"},
      {"name":"‡∏õ‡∏±‡πä‡∏°‡∏ß‡∏¥‡πÄ‡∏ä‡∏µ‡∏¢‡∏£","date":"2025-07-16","DS":1000,"G91":0,"G95":500,"supplier":"‡∏ä.‡∏û‡∏¥‡∏ö‡∏π‡∏•","lat":17.762843895849546,"lng":103.83351872442522,"amphoe":"‡∏Ñ‡∏≥‡∏ï‡∏≤‡∏Å‡∏•‡πâ‡∏≤","province":"‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£","resource":"","sender":"‡∏û‡∏µ‡πà‡∏à‡∏∏‡πà‡∏ô","note":"","BU":"ST"},
      {"name":"‡∏õ‡∏±‡πâ‡∏°‡πÅ‡∏°‡πà‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏¥‡∏ï","date":"2025-07-16","DS":5000,"G91":0,"G95":500,"supplier":"‡∏ä.‡∏ß‡∏¥‡∏ö‡∏π‡∏•‡∏¢‡πå(‡∏û‡∏£‡πÄ‡∏à‡∏£‡∏¥‡∏ç)","lat":18.08340236089418,"lng":103.95153636676265,"amphoe":"‡πÄ‡∏ã‡∏Å‡∏≤","province":"‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨","resource":"","sender":"‡∏û‡∏µ‡πà‡πÇ‡∏Å‡πâ","note":"‡∏£‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏Å‡∏±‡∏ö‡∏´‡∏ô‡∏≠‡∏á‡∏Ñ‡∏≤‡∏¢‡∏£‡∏∏‡πà‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏á‡∏î‡πâ‡∏ß‡∏¢","BU":"KN"},
      {"name":"‡∏õ‡∏±‡πä‡∏°‡∏´‡∏ß‡πâ‡∏≤‡πÉ‡∏´‡∏ç‡πà","date":"2025-07-16","DS":500,"G91":0,"G95":500,"supplier":"‡∏ô‡∏≤‡∏ó‡∏µ‡∏û‡∏≤‡∏ì‡∏¥‡∏ä","lat":17.628680483437247,"lng":103.95553545325721,"amphoe":"‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢","province":"‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£","resource":"","sender":"‡∏û‡∏µ‡πà‡∏à‡∏∏‡πà‡∏ô","note":"","BU":"ST"},
      {"name":"‡∏õ‡∏±‡πä‡∏°‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£","date":"2025-07-16","DS":4000,"G91":0,"G95":450,"supplier":"‡∏õ‡∏ï‡∏ó.","lat":17.555747336910922,"lng":104.0201282667504,"amphoe":"‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢","province":"‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£","resource":"","sender":"‡∏û‡∏µ‡πà‡∏à‡∏∏‡πà‡∏ô","note":"","BU":"ST"},
      {"name":"‡∏õ‡∏±‡πâ‡∏°‡∏ö‡∏∏‡∏ç‡πÄ‡∏à‡∏£‡∏¥‡∏ç ‡∏ö‡∏∂‡∏á‡πÇ‡∏Ç‡∏á‡∏´‡∏•‡∏á","date":"2025-07-16","DS":0,"G91":0,"G95":0,"supplier":"‡∏ô‡∏≤‡∏ó‡∏µ‡∏ß‡∏≤‡∏ô‡∏£","lat":17.990175260456073,"lng":104.08603603792535,"amphoe":"‡∏ö‡∏∂‡∏á‡πÇ‡∏Ç‡∏á‡∏´‡∏•‡∏á","province":"‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨","resource":"","sender":"‡∏û‡∏µ‡πà‡πÇ‡∏Å‡πâ","note":"","BU":"KN"},
      {"name":"‡∏õ‡∏±‡πâ‡∏°‡∏à‡∏á‡∏£‡∏≤‡∏ä‡∏≤‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå","date":"2025-07-17","DS":10000,"G91":0,"G95":5000,"supplier":"‡∏•‡∏¥‡∏ï‡∏£‡∏ô‡∏†‡∏≤","lat":17.390122237074333,"lng":104.38102149558154,"amphoe":"‡∏Å‡∏∏‡∏™‡∏∏‡∏°‡∏≤‡∏•‡∏¢‡πå","province":"‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£","resource":"","sender":"‡∏û‡∏µ‡πà‡πÇ‡∏Å‡πâ","note":"‡∏õ‡∏±‡πâ‡∏°‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏õ‡∏µ ‡∏™‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏™‡∏£‡∏¥‡∏ü","BU":"KN"},
      {"name":"‡∏õ‡∏±‡πä‡∏° ‡∏ã‡∏µ ‡πÄ‡∏Ñ ‡∏≠‡∏≠‡∏¢‡∏•‡πå 1992","date":"2025-07-17","DS":10000,"G91":6000,"G95":10000,"supplier":"‡∏Ñ‡∏≠‡∏™‡πÇ‡∏°‡πà","lat":17.224286946572104,"lng":104.1068117244128,"amphoe":"‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£","province":"‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£","resource":"","sender":"‡∏û‡∏µ‡πà‡∏à‡∏∏‡πà‡∏ô","note":"","BU":"ST"},
      {"name":"‡∏õ‡∏±‡πâ‡∏°‡∏û‡πà‡∏≠‡∏û‡∏¥‡∏ô‡∏¥‡∏à","date":"2025-07-17","DS":10000,"G91":0,"G95":5000,"supplier":"PT‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£","lat":17.38631393402591,"lng":103.78297745140618,"amphoe":"‡∏û‡∏±‡∏á‡πÇ‡∏Ñ‡∏ô","province":"‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£","resource":"","sender":"‡∏û‡∏µ‡πà‡πÇ‡∏Å‡πâ","note":"","BU":"KN"},
      {"name":"‡∏õ‡∏±‡πä‡∏°‡∏≠‡∏µ‡πä‡∏î‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ ‡∏û‡∏£‡∏£‡∏ì‡∏≤‡∏ô‡∏¥‡∏Ñ‡∏°","date":"2025-07-17","DS":1000,"G91":0,"G95":500,"supplier":"PT‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏ß‡πà‡∏≤‡∏á‡πÅ‡∏î‡∏ô‡∏î‡∏¥‡∏ô","lat":17.363891001952435,"lng":103.78976562441613,"amphoe":"‡∏û‡∏£‡∏£‡∏ì‡∏≤‡∏ô‡∏¥‡∏Ñ‡∏°","province":"‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£","resource":"","sender":"‡∏û‡∏µ‡πà‡πÇ‡∏Å‡πâ","note":"","BU":"KN"},
      {"name":"‡∏õ‡∏±‡πä‡∏°‡∏≠‡∏ô‡∏±‡∏ô‡∏ï‡πå","date":"2025-07-17","DS":1400,"G91":500,"G95":0,"supplier":"‡∏õ‡∏ï‡∏ó ‡∏î‡∏á‡∏°‡∏∞‡πÑ‡∏ü","lat":17.266569663639924,"lng":103.97206018208398,"amphoe":"‡∏û‡∏£‡∏£‡∏ì‡∏≤‡∏ô‡∏¥‡∏Ñ‡∏°","province":"‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£","resource":"","sender":"‡∏û‡∏µ‡πà‡∏à‡∏∏‡πà‡∏ô","note":"","BU":"ST"},
      {"name":"‡∏õ‡∏±‡πâ‡∏°TD ‡∏ò‡∏ô‡∏™‡∏¥‡∏ô‡∏î‡∏µ ‡∏ß‡∏≤‡∏£‡∏¥‡∏ä‡∏†‡∏π‡∏°‡∏¥","date":"2025-07-17","DS":5000,"G91":0,"G95":500,"supplier":"‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå","lat":17.24446786834928,"lng":103.65504311091858,"amphoe":"‡∏ß‡∏≤‡∏£‡∏¥‡∏ä‡∏†‡∏π‡∏°‡∏¥","province":"‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£","resource":"","sender":"‡∏û‡∏µ‡πà‡πÇ‡∏Å‡πâ","note":"‡∏™‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏£‡∏≤‡∏Ñ‡∏≤ ‡πÑ‡∏°‡πà‡∏¢‡∏∂‡∏î‡∏ï‡∏¥‡∏î‡∏Ñ‡∏£‡∏±‡∏ö","BU":"KN"},
      {"name":"‡∏õ‡∏±‡πâ‡∏°‡πÉ‡∏à‡∏î‡∏µ‡∏≠‡∏≠‡∏¢‡∏•‡πå","date":"2025-07-17","DS":2000,"G91":0,"G95":500,"supplier":"","lat":17.26672434484204,"lng":103.63399956674371,"amphoe":"‡∏ß‡∏≤‡∏£‡∏¥‡∏ä‡∏†‡∏π‡∏°‡∏¥","province":"‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£","resource":"‡∏°‡∏µ‡∏£‡∏ñ‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå6 ‡∏•‡πâ‡∏≠1 ‡∏Ñ‡∏±‡∏ô","sender":"‡∏û‡∏µ‡πà‡πÇ‡∏Å‡πâ","note":"‡∏Å‡∏£‡∏≠‡∏Å‡∏õ‡∏±‡πâ‡∏°‡πÉ‡∏´‡∏ç‡πà ‡∏ß‡∏¥‡πà‡∏á‡∏Ç‡∏≤‡∏¢‡∏™‡∏≤‡∏¢‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏à‡∏≥","BU":"KN"},
      {"name":"‡∏õ‡∏±‡πâ‡∏°‡∏û‡πà‡∏≠‡∏ä‡∏≤","date":"2025-07-17","DS":0,"G91":0,"G95":0,"supplier":"","lat":17.271375085001825,"lng":103.63325603790868,"amphoe":"‡∏ß‡∏≤‡∏£‡∏¥‡∏ä‡∏†‡∏π‡∏°‡∏¥","province":"‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£","resource":"‡∏°‡∏µ‡∏£‡∏ñ‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå6 ‡∏•‡πâ‡∏≠1 ‡∏Ñ‡∏±‡∏ô","sender":"‡∏û‡∏µ‡πà‡πÇ‡∏Å‡πâ","note":"","BU":"KN"},
      {"name":"‡∏õ‡∏±‡πâ‡∏°‡∏ò‡∏ô‡∏±‡∏ä‡πÇ‡∏ä‡∏ï‡∏¥","date":"2025-07-17","DS":0,"G91":0,"G95":0,"supplier":"","lat":17.36068156508588,"lng":103.8363719955808,"amphoe":"‡∏û‡∏£‡∏£‡∏ì‡∏≤‡∏ô‡∏¥‡∏Ñ‡∏°","province":"‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£","resource":"‡∏°‡∏µ‡∏£‡∏ñ‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå6 ‡∏•‡πâ‡∏≠1 ‡∏Ñ‡∏±‡∏ô","sender":"‡∏û‡∏µ‡πà‡πÇ‡∏Å‡πâ","note":"","BU":"KN"}
    ];

    // ===== Icons =====
    const redIcon = L.icon({ iconUrl: "https://maps.google.com/mapfiles/ms/icons/red-dot.png", iconSize: [32,32], iconAnchor: [16,32], popupAnchor: [0,-28] });
    const blueIcon = L.icon({ iconUrl: "https://maps.google.com/mapfiles/ms/icons/blue-dot.png", iconSize: [32,32], iconAnchor: [16,32], popupAnchor: [0,-28] });
    const greenIcon = L.icon({ iconUrl: "https://maps.google.com/mapfiles/ms/icons/green-dot.png", iconSize: [32,32], iconAnchor: [16,32], popupAnchor: [0,-28] });

    // ===== Map =====
    const map = L.map("map", { center: [branch.lat, branch.lng], zoom: 8 });
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", { attribution: "&copy; OpenStreetMap contributors" }).addTo(map);

    // Branch marker & radius
    L.marker([branch.lat, branch.lng], { icon: redIcon })
      .addTo(map)
      .bindPopup(`<b>${branch.name}</b><br><a href="https://www.google.com/maps?q=${branch.lat},${branch.lng}" target="_blank" rel="noopener">‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô Google Maps</a>`)
      .openPopup();
    const circle = L.circle([branch.lat, branch.lng], { radius: branch.radius_m, color: "#d00", weight: 2, fillColor: "#d00", fillOpacity: 0.08 }).addTo(map);

    // Layers
    const layerBlue = L.layerGroup().addTo(map);
    const layerGreen = L.layerGroup().addTo(map);

    // Popup
    function popupHTML(p) {
      const liters = (v) => (v == null ? "0" : v);
      const dateDisp = p.date || "-";
      const resourceLine = p.resource ? `‚öôÔ∏è <b>Resource:</b> ${p.resource}<br>` : "";
      return `
        <b>${p.name}</b><br>
        üìÖ <b>Date:</b> ${dateDisp}<br>
        üè∑Ô∏è <b>Supplier:</b> ${p.supplier ?? "-"}<br>
        ‚õΩ <b>DS/G91/G95:</b> ${liters(p.DS)}/${liters(p.G91)}/${liters(p.G95)} ‡∏•‡∏¥‡∏ï‡∏£<br>
        üìç <b>${p.amphoe ?? ""}${p.province ? ", "+p.province : ""}</b><br>
        ${resourceLine}
        üë§ <b>Sender:</b> ${p.sender ?? "-"}<br>
        üìù <b>Note:</b> ${p.note || "-"}<br>
        <a href="https://www.google.com/maps?q=${p.lat},${p.lng}" target="_blank" rel="noopener">‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô Google Maps</a>`;
    }
    function addPoints(data, icon, layer) {
      data.forEach(p => {
        L.marker([p.lat, p.lng], { icon }).addTo(layer).bindPopup(popupHTML(p));
      });
    }

    // Reach box
    const reachCtrl = L.control({ position: "topleft" });
    reachCtrl.onAdd = () => {
      const div = L.DomUtil.create("div", "reach");
      div.innerHTML = `
        <div class="title">üéØ Target Reach (Leads): Actual / Market Size</div>
        <div id="reachRows"></div>`;
      L.DomEvent.disableClickPropagation(div);
      return div;
    };
    reachCtrl.addTo(map);

    function renderReach(fBlue, fGreen) {
      const all = [...fBlue, ...fGreen];
      const byProvince = {};
      all.forEach(p => {
        const prov = p.province || "‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î";
        byProvince[prov] = (byProvince[prov] || 0) + 1;
      });
      const wrap = document.getElementById("reachRows");
      let html = "";
      Object.keys(MARKET_SIZE).forEach(prov => {
        const actual = byProvince[prov] || 0;
        const market = MARKET_SIZE[prov];
        const pct = market ? (actual / market) * 100 : 0;
        html += `<div class="row"><div class="label"><span>${prov}</span><span>${actual}/${market} (${pct.toFixed(2)}%)</span></div><div class="bar"><span style="width:${Math.min(pct,100)}%"></span></div></div>`;
      });
      Object.keys(byProvince).forEach(prov => {
        if (!(prov in MARKET_SIZE)) {
          const actual = byProvince[prov];
          html += `<div class="row"><div class="label"><span>${prov}</span><span>${actual}/-</span></div><div class="bar"><span style="width:0%"></span></div></div>`;
        }
      });
      wrap.innerHTML = html || `<div style="opacity:.8">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</div>`;
    }

    function renderAll(filteredBlue = blueData, filteredGreen = greenData) {
      layerBlue.clearLayers();
      layerGreen.clearLayers();
      addPoints(filteredBlue, blueIcon, layerBlue);
      addPoints(filteredGreen, greenIcon, layerGreen);

      const b = L.latLngBounds();
      b.extend(circle.getBounds());
      layerBlue.eachLayer(l => b.extend(l.getLatLng()));
      layerGreen.eachLayer(l => b.extend(l.getLatLng()));
      if (b.isValid()) map.fitBounds(b.pad(0.1));

      updateCounts(filteredBlue, filteredGreen);
      renderReach(filteredBlue, filteredGreen);
    }

    // Filter control
    const filterCtrl = L.control({ position: "topright" });
    filterCtrl.onAdd = () => {
      const div = L.DomUtil.create("div", "filterbox");
      div.innerHTML = `
        <div class="title">üìÜ Filter by Date</div>
        <div class="row">
          <label for="startDate">‡πÄ‡∏£‡∏¥‡πà‡∏°</label>
          <input id="startDate" type="date" />
        </div>
        <div class="row">
          <label for="endDate">‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
          <input id="endDate" type="date" />
        </div>
        <div class="actions">
          <button id="applyBtn">Apply</button>
          <button id="clearBtn">Clear</button>
        </div>
        <div class="stat" id="filterStat">‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>`;
      L.DomEvent.disableClickPropagation(div);
      return div;
    };
    filterCtrl.addTo(map);

    // Sales summary (dynamic)
    const salesCtrl = L.control({ position: "topright" });
    salesCtrl.onAdd = () => {
      const div = L.DomUtil.create("div", "salesbox");
      div.innerHTML = `
        <div class="title">üíº ‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏£‡∏¥‡∏á</div>
        <div class="row"><span>Actual Leads (‡∏£‡∏≤‡∏¢)</span><span class="value" id="cntCustomers">0</span></div>
        <div class="row"><span>Actual Market Size (‡∏•‡∏¥‡∏ï‡∏£)</span><span class="value" id="sumLiters">0</span></div>`;
      L.DomEvent.disableClickPropagation(div);
      return div;
    };
    salesCtrl.addTo(map);

    function updateCounts(fBlue, fGreen) {
      const all = [...fBlue, ...fGreen];
      const customers = all.length;
      const liters = all.reduce((acc, p) => acc + (p.DS||0) + (p.G91||0) + (p.G95||0), 0);
      const fmt = (n) => n.toLocaleString();
      document.getElementById('cntCustomers').textContent = fmt(customers);
      document.getElementById('sumLiters').textContent = fmt(liters);
    }

    // NEW: Close Won Summary (fixed numbers)
    const FIXED_WON_CUSTOMERS = 0;
    const FIXED_WON_LITERS = 0;
    const wonCtrl = L.control({ position: "topright" });
    wonCtrl.onAdd = () => {
      const div = L.DomUtil.create("div", "wonbox");
      div.innerHTML = `
        <div class="title">üèÅ Close Won Summary</div>
        <div class="row"><span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ (‡∏£‡∏≤‡∏¢)</span><span class="value">${FIXED_WON_CUSTOMERS}</span></div>
        <div class="row"><span>‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ (‡∏•‡∏¥‡∏ï‡∏£)</span><span class="value">${FIXED_WON_LITERS.toLocaleString()}</span></div>`;
      L.DomEvent.disableClickPropagation(div);
      return div;
    };
    wonCtrl.addTo(map);

    // Date filtering
    function parseYMD(s) { if (!s) return null; const [y,m,d] = s.split('-').map(Number); return new Date(y, m-1, d); }
    function within(dateStr, startStr, endStr) {
      if (!startStr && !endStr) return true;
      const d = parseYMD(dateStr); if (!d) return false;
      const s = startStr ? parseYMD(startStr) : null;
      const e = endStr ? parseYMD(endStr) : null;
      if (s && d < s) return false; if (e && d > e) return false; return true;
    }
    function applyFilter() {
      const start = document.getElementById('startDate').value;
      const end = document.getElementById('endDate').value;
      const fGreen = greenData.filter(p => within(p.date, start, end));
      const fBlue  = blueData.filter(p => within(p.date, start, end));
      renderAll(fBlue, fGreen);
      const stat = document.getElementById('filterStat');
      if (!start && !end) stat.textContent = '‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î';
      else if (start && end) stat.textContent = `‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${start} ‡∏ñ‡∏∂‡∏á ${end}`;
      else if (start) stat.textContent = `‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${start}`;
      else stat.textContent = `‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${end}`;
    }
    function clearFilter() { document.getElementById('startDate').value=''; document.getElementById('endDate').value=''; applyFilter(); }
    function wireFilterEvents() {
      document.getElementById('applyBtn').addEventListener('click', applyFilter);
      document.getElementById('clearBtn').addEventListener('click', clearFilter);
      ['startDate','endDate'].forEach(id => { document.getElementById(id).addEventListener('change', applyFilter); });
    }

    // Initial render
    renderAll();
    wireFilterEvents();

    // Legend
    const legend = L.control({ position: "bottomleft" });
    legend.onAdd = () => {
      const div = L.DomUtil.create("div", "legend");
      div.innerHTML = `
        <div style="font-weight:600; margin-bottom:4px;">‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå</div>
        <div class="row"><span class="dot red"></span> ‡∏™‡∏≤‡∏Ç‡∏≤ + ‡∏£‡∏±‡∏®‡∏°‡∏µ 80 ‡∏Å‡∏°.</div>
        <div class="row"><span class="dot blue"></span> Leads ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (Blue)</div>
        <div class="row"><span class="dot green"></span> Leads ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö DBD (Green)</div>`;
      return div;
    };
    legend.addTo(map);
  </script>
</body>
</html>
