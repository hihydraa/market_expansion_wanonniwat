<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>สาขา วานรนิวาส + ลูกค้า</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100vh; width: 100vw; }
    .legend {
      position: absolute; bottom: 16px; left: 16px;
      background: white; padding: 14px 16px; border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,.15); font-family: sans-serif; font-size: 16px;
      min-width: 240px;
    }
    .legend .row { display: flex; align-items: center; gap: 8px; margin: 6px 0; }
    .dot { width: 14px; height: 14px; border-radius: 50%; display: inline-block; }
    .dot.red { background: #d00; }
    .dot.blue { background: #2a62ff; }
    .dot.green { background: #2ecc71; }
     .reach {
    position: absolute;
    top: 16px;
    left: 16px;
    background: linear-gradient(135deg, #ffffff, #f9fbff);
    padding: 16px 20px;
    border-radius: 14px;
    border: 1px solid #dce3f0;
    box-shadow: 0 4px 16px rgba(0,0,0,.15);
    font-family: "Segoe UI", sans-serif;
    font-size: 15px;
    min-width: 380px;
      }
      .reach .title {
        font-weight: 700;
        font-size: 16px;
        margin-bottom: 10px;
        color: #2c3e50;
        border-bottom: 2px solid #4a90e2;
        padding-bottom: 6px;
      }
      .reach .row {
        display: flex;
        flex-direction: column;
        margin: 8px 0;
      }
      .reach .label {
        display: flex;
        justify-content: space-between;
        margin-bottom: 4px;
      }
      .reach .bar {
        height: 10px;
        background: #e0e6f5;
        border-radius: 5px;
        overflow: hidden;
      }
      .reach .bar span {
        display: block;
        height: 100%;
        background: linear-gradient(90deg, #4a90e2, #50c9ce);
      }

  
    .salesbox {
      position: absolute;
      top: 16px;
      right: 16px;
      background: linear-gradient(135deg, #ffffff, #fffaf5);
      padding: 16px 20px;
      border-radius: 14px;
      border: 1px solid #f0dcc3;
      box-shadow: 0 4px 16px rgba(0,0,0,.15);
      font-family: "Segoe UI", sans-serif;
      font-size: 15px;
      min-width: 280px;
    }
    .salesbox .title {
      font-weight: 700;
      font-size: 16px;
      margin-bottom: 10px;
      color: #6b3f00;
      border-bottom: 2px solid #ffb257;
      padding-bottom: 6px;
    }
    .salesbox .row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #fff4e5;
      margin: 6px 0;
      padding: 8px 12px;
      border-radius: 10px;
    }
    .salesbox .value {
      font-weight: 700;
      font-size: 18px;
      color: #7a4d00;
    }
    
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const branch = {
      name: "สาขา วานรนิวาส",
      lat: 17.62932338805625,
      lng: 103.76765900596575,
      radius_m: 80000
    };

    const customersBlue = [
      { name: `ปั๊มพิชัยบริการ`, lat: 17.86715479, lng: 103.59521900, popup: `<b>ปั๊มพิชัยบริการ</b><br>Supplier ปัจจุบัน: ไทยรุ่งเรืองบึงกาฬ<br>DS (ลิตร): 6000<br>G91 (ลิตร): 0<br>G95 (ลิตร): 200<br>Sender: พี่จุ่น<br>Note: ถัง 200 ลิตร 2 ถัง` },
      { name: `ปั๊มใจดี บ่อแก้วบริการ`, lat: 17.86642637, lng: 103.59515145, popup: `<b>ปั๊มใจดี บ่อแก้วบริการ</b><br>Supplier ปัจจุบัน: ศรีพลัง<br>DS (ลิตร): 18000<br>G91 (ลิตร): 4000<br>G95 (ลิตร): 4000<br>Sender: พี่ต้น<br>Note: nan` },
      { name: `ปั๊มนันมินิมาร์ท`, lat: 17.92505610, lng: 103.66866827, popup: `<b>ปั๊มนันมินิมาร์ท</b><br>Supplier ปัจจุบัน: ไทยรุ่งเรือง <br>DS (ลิตร): 3000<br>G91 (ลิตร): 0<br>G95 (ลิตร): 500<br>Sender: พี่ต้น<br>Note: ซื้อเงินสด / ราคาเราสู้ได้ DS ซื้อลิตรละ 32.00` },
      { name: `ปั้มสมพรการค้า รับมิเตอร์`, lat: 17.95767479, lng: 103.68048112, popup: `<b>ปั้มสมพรการค้า รับมิเตอร์</b><br>Supplier ปัจจุบัน: ไทยรุ่งเรือง<br>DS (ลิตร): 500<br>G91 (ลิตร): 0<br>G95 (ลิตร): 500<br>Sender: พี่โก้<br>Note: nan` },
      { name: `ปั๊มชุมชนสาธิตการตลาด บ้านพอกใหญ่`, lat: 17.85880395, lng: 103.71931081, popup: `<b>ปั๊มชุมชนสาธิตการตลาด บ้านพอกใหญ่</b><br>Supplier ปัจจุบัน: nan<br>DS (ลิตร): 4000<br>G91 (ลิตร): 0<br>G95 (ลิตร): 2000<br>Sender: พี่จุ่น<br>Note: nan` },
      { name: `ปั้มไพศาลบริการ อ.เมืองบึงกาฬ`, lat: 18.27510284, lng: 103.85332001, popup: `<b>ปั้มไพศาลบริการ อ.เมืองบึงกาฬ</b><br>Supplier ปัจจุบัน: หนองคายไทยรุ่งเรือง<br>DS (ลิตร): 9000<br>G91 (ลิตร): 5000<br>G95 (ลิตร): 5000<br>Sender: พี่โก้<br>Note: nan` },
      { name: `ปั้มสิริวัฒน์`, lat: 18.17910238, lng: 103.89704795, popup: `<b>ปั้มสิริวัฒน์</b><br>Supplier ปัจจุบัน: ช.วิบูลย์(พรเจริญ)<br>DS (ลิตร): 3000<br>G91 (ลิตร): 0<br>G95 (ลิตร): 500<br>Sender: พี่โก้<br>Note: nan` },
      { name: `ปั้มทรัพย์มั่นคง99`, lat: 18.10544285, lng: 103.84663707, popup: `<b>ปั้มทรัพย์มั่นคง99</b><br>Supplier ปัจจุบัน: หนองคายไทยรุ่งเรือง<br>DS (ลิตร): 0<br>G91 (ลิตร): 0<br>G95 (ลิตร): 0<br>Sender: พี่โก้<br>Note: รับน้ำมันกับหนองคายรุ่งเรืองทั้ง 3 สาขา` },
      { name: `ปั๊มป่านตะวัน`, lat: 17.76591902, lng: 103.81766172, popup: `<b>ปั๊มป่านตะวัน</b><br>Supplier ปัจจุบัน: รีพลัง <br>DS (ลิตร): 4000<br>G91 (ลิตร): 0<br>G95 (ลิตร): 500<br>Sender: พี่จุ่น<br>Note: nan` },
      { name: `ปั้มบ้านนาแสง`, lat: 18.11623753, lng: 103.86627257, popup: `<b>ปั้มบ้านนาแสง</b><br>Supplier ปัจจุบัน: วิบูลย์(พรเจริญ)<br>DS (ลิตร): 0<br>G91 (ลิตร): 0<br>G95 (ลิตร): 0<br>Sender: พี่โก้<br>Note: nan` },
      { name: `ปั๊มวิเชียร`, lat: 17.76284390, lng: 103.83351872, popup: `<b>ปั๊มวิเชียร</b><br>Supplier ปัจจุบัน: ช.พิบูล <br>DS (ลิตร): 1000<br>G91 (ลิตร): 0<br>G95 (ลิตร): 500<br>Sender: พี่จุ่น<br>Note: nan` },
      { name: `ปั้มแม่เต็มจิต`, lat: 18.08340236, lng: 103.95153637, popup: `<b>ปั้มแม่เต็มจิต</b><br>Supplier ปัจจุบัน: ช.วิบูลย์(พรเจริญ)<br>DS (ลิตร): 5000<br>G91 (ลิตร): 0<br>G95 (ลิตร): 500<br>Sender: พี่โก้<br>Note: รับน้ำมันกับหนองคายรุ่งเรืองด้วย` },
      { name: `ปั๊มหว้าใหญ่`, lat: 17.62868048, lng: 103.95553545, popup: `<b>ปั๊มหว้าใหญ่</b><br>Supplier ปัจจุบัน: นาทีพาณิช <br>DS (ลิตร): 500<br>G91 (ลิตร): 0<br>G95 (ลิตร): 500<br>Sender: พี่จุ่น<br>Note: nan` },
      { name: `ปั๊มขายดีบริการ`, lat: 17.55574734, lng: 104.02012827, popup: `<b>ปั๊มขายดีบริการ</b><br>Supplier ปัจจุบัน: ปตท.<br>DS (ลิตร): 4000<br>G91 (ลิตร): 0<br>G95 (ลิตร): 450<br>Sender: พี่จุ่น<br>Note: nan` },
      { name: `ปั้มบุญเจริญ บึงโขงหลง`, lat: 17.99017526, lng: 104.08603604, popup: `<b>ปั้มบุญเจริญ บึงโขงหลง</b><br>Supplier ปัจจุบัน: นาทีวานร<br>DS (ลิตร): 0<br>G91 (ลิตร): 0<br>G95 (ลิตร): 0<br>Sender: พี่โก้<br>Note: nan` },
      { name: `ปั้มจงราชาทรัพย์`, lat: 17.39012224, lng: 104.38102150, popup: `<b>ปั้มจงราชาทรัพย์</b><br>Supplier ปัจจุบัน: ลิตรนภา<br>DS (ลิตร): 10000<br>G91 (ลิตร): 0<br>G95 (ลิตร): 5000<br>Sender: พี่โก้<br>Note: ปั้มใหม่เปิดยังไม่ถึงปี สู้ที่ราคาและเวลาเสริฟ` },
      { name: `ปั๊ม ซี เค ออยล์ 1992`, lat: 17.22428695, lng: 104.10681172, popup: `<b>ปั๊ม ซี เค ออยล์ 1992</b><br>Supplier ปัจจุบัน: คอสโม่ <br>DS (ลิตร): 10000<br>G91 (ลิตร): 6000<br>G95 (ลิตร): 10000<br>Sender: พี่จุ่น<br>Note: nan` },
      { name: `ปั้มพ่อพินิจ`, lat: 17.38631393, lng: 103.78297745, popup: `<b>ปั้มพ่อพินิจ</b><br>Supplier ปัจจุบัน: PTประมวลบริการ<br>DS (ลิตร): 10000<br>G91 (ลิตร): 0<br>G95 (ลิตร): 5000<br>Sender: พี่โก้<br>Note: nan` },
      { name: `ปั๊มอี๊ดบริการ พรรณานิคม`, lat: 17.36389100, lng: 103.78976562, popup: `<b>ปั๊มอี๊ดบริการ พรรณานิคม</b><br>Supplier ปัจจุบัน: PTประมวลบริการสว่างแดนดิน<br>DS (ลิตร): 1000<br>G91 (ลิตร): 0<br>G95 (ลิตร): 500<br>Sender: พี่โก้<br>Note: nan` },
      { name: `ปั๊มอนันต์`, lat: 17.26656966, lng: 103.97206018, popup: `<b>ปั๊มอนันต์</b><br>Supplier ปัจจุบัน: ปตท ดงมะไฟ <br>DS (ลิตร): 1400<br>G91 (ลิตร): 500<br>G95 (ลิตร): 0<br>Sender: พี่จุ่น<br>Note: nan` },
      { name: `ปั้มTD ธนสินดี วาริชภูมิ`, lat: 17.24446787, lng: 103.65504311, popup: `<b>ปั้มTD ธนสินดี วาริชภูมิ</b><br>Supplier ปัจจุบัน: สุขสันต์<br>DS (ลิตร): 5000<br>G91 (ลิตร): 0<br>G95 (ลิตร): 500<br>Sender: พี่โก้<br>Note: สู้ที่ราคา ไม่ยึดติดครับ` },
      { name: `ปั้มใจดีออยล์`, lat: 17.26672434, lng: 103.63399957, popup: `<b>ปั้มใจดีออยล์</b><br>Supplier ปัจจุบัน: nan<br>DS (ลิตร): 2000<br>G91 (ลิตร): 0<br>G95 (ลิตร): 500<br>Sender: พี่โก้<br>Note: กรอกปั้มใหญ่ วิ่งขายสายลูกค้าประจำ ` },
      { name: `ปั้มพ่อชา`, lat: 17.27137509, lng: 103.63325604, popup: `<b>ปั้มพ่อชา</b><br>Supplier ปัจจุบัน: nan<br>DS (ลิตร): 0<br>G91 (ลิตร): 0<br>G95 (ลิตร): 0<br>Sender: พี่โก้<br>Note: nan` },
      { name: `ปั้มธนัชโชติ`, lat: 17.36068157, lng: 103.83637200, popup: `<b>ปั้มธนัชโชติ</b><br>Supplier ปัจจุบัน: nan<br>DS (ลิตร): 0<br>G91 (ลิตร): 0<br>G95 (ลิตร): 0<br>Sender: พี่โก้<br>Note: nan` }
    ];
    const customersGreen = [
      { name: `ปั๊มอุทัยบริการ`, lat: 17.76532968, lng: 103.81967818, popup: `<b>ปั๊มอุทัยบริการ</b><br>Supplier ปัจจุบัน: PT,ไทยรุ่งเรือง<br>DS (ลิตร): 9000<br>G91 (ลิตร): 2500<br>G95 (ลิตร): 2500<br>Sender: พี่จุ่น` },
      { name: `ปั้มหนองคายไทยรุ่งเรือง (หจก.หนองคายไทยรุ่งเรือง)`, lat: 18.02028970, lng: 103.70718204, popup: `<b>ปั้มหนองคายไทยรุ่งเรือง (หจก.หนองคายไทยรุ่งเรือง)</b><br>Supplier ปัจจุบัน: ปั้มหนองคายไทยรุ่งเรือง<br>DS (ลิตร): 0<br>G91 (ลิตร): 0<br>G95 (ลิตร): 0<br>Sender: พี่โก้<br>Note: มีเทลเลอร์ 3 หาง 1 หัวลาก / 10 ล้อ 3 / มิเตอร์ 1` },
      { name: `ปั้มเทพปราณี (หจก.เทพปราณี 1969)`, lat: 17.94366352, lng: 104.03124315, popup: `<b>ปั้มเทพปราณี (หจก.เทพปราณี 1969)</b><br>Supplier ปัจจุบัน: สุขสันต์<br>DS (ลิตร): 8000<br>G91 (ลิตร): 0<br>G95 (ลิตร): 4000<br>Sender: พี่โก้<br>Note: รับกับเทลเลอร์` },
      { name: `ปตท.ดงมะไฟ (หจก.เทวินปิโตรเลียม)`, lat: 17.27784488, lng: 103.99184172, popup: `<b>ปตท.ดงมะไฟ (หจก.เทวินปิโตรเลียม)</b><br>Supplier ปัจจุบัน: ปตท ดงมะไฟ<br>DS (ลิตร): 0<br>G91 (ลิตร): 0<br>G95 (ลิตร): 0<br>Sender: พี่จุ่น` }
    ];

    const redIcon = L.icon({
      iconUrl: "https://maps.google.com/mapfiles/ms/icons/red-dot.png",
      iconSize: [32, 32], iconAnchor: [16, 32], popupAnchor: [0, -28]
    });
    const blueIcon = L.icon({
      iconUrl: "https://maps.google.com/mapfiles/ms/icons/blue-dot.png",
      iconSize: [32, 32], iconAnchor: [16, 32], popupAnchor: [0, -28]
    });
    const greenIcon = L.icon({
      iconUrl: "https://maps.google.com/mapfiles/ms/icons/green-dot.png",
      iconSize: [32, 32], iconAnchor: [16, 32], popupAnchor: [0, -28]
    });

    const map = L.map("map", { center: [branch.lat, branch.lng], zoom: 8 });
    
    // Closed Won / Sales summary (right side)
    const salesCtrl = L.control({ position: "topright" });
    salesCtrl.onAdd = () => {
      const div = L.DomUtil.create("div", "salesbox");
      div.innerHTML = `
        <div class="title">💼 Closed Won Summary</div>
        <div class="row"><span>จำนวนลูกค้า (ราย)</span><span class="value">0</span></div>
        <div class="row"><span>ยอดขาย (ลิตร)</span><span class="value">0</span></div>
      `;
      return div;
    };
    salesCtrl.addTo(map);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "&copy; OpenStreetMap contributors"
    }).addTo(map);

    // Target Reach box
  const reachCtrl = L.control({ position: "topleft" });
  reachCtrl.onAdd = () => {
  const div = L.DomUtil.create("div", "reach");
  div.innerHTML = `
    <div class="title">🎯 Target Reach (Leads): Actual / Market Size</div>
    
    <div class="row">
      <div class="label"><span>สกลนคร</span><span>19/102 (18.63%)</span></div>
      <div class="bar"><span style="width:18.63%"></span></div>
    </div>
    
    <div class="row">
      <div class="label"><span>บึงกาฬ</span><span>9/40 (22.50%)</span></div>
      <div class="bar"><span style="width:22.5%"></span></div>
    </div>
  `;
  return div;
};
reachCtrl.addTo(map);


    L.marker([branch.lat, branch.lng], { icon: redIcon })
      .addTo(map)
      .bindPopup(
        `<b>${branch.name}</b><br>` +
        `<a href="https://www.google.com/maps?q=${branch.lat},${branch.lng}" target="_blank" rel="noopener">เปิดใน Google Maps</a>`
      )
      .openPopup();

    const circle = L.circle([branch.lat, branch.lng], {
      radius: branch.radius_m, color: "#d00", weight: 2, fillColor: "#d00", fillOpacity: 0.08
    }).addTo(map);

    const layerBlue = L.layerGroup().addTo(map);
    const layerGreen = L.layerGroup().addTo(map);

    customersBlue.forEach(c => {
      L.marker([c.lat, c.lng], { icon: blueIcon })
        .addTo(layerBlue)
        .bindPopup(
          (c.popup || `<b>${c.name}</b>`) +
          `<br><a href="https://www.google.com/maps?q=${c.lat},${c.lng}" target="_blank" rel="noopener">เปิดใน Google Maps</a>`
        );
    });
    customersGreen.forEach(c => {
      L.marker([c.lat, c.lng], { icon: greenIcon })
        .addTo(layerGreen)
        .bindPopup(
          (c.popup || `<b>${c.name}</b>`) +
          `<br><a href="https://www.google.com/maps?q=${c.lat},${c.lng}" target="_blank" rel="noopener">เปิดใน Google Maps</a>`
        );
    });

    const bounds = L.latLngBounds([[branch.lat, branch.lng]]);
    bounds.extend(circle.getBounds());
    layerBlue.eachLayer(l => bounds.extend(l.getLatLng()));
    layerGreen.eachLayer(l => bounds.extend(l.getLatLng()));
    map.fitBounds(bounds.pad(0.1));

    const legend = L.control({ position: "bottomleft" });
    legend.onAdd = () => {
      const div = L.DomUtil.create("div", "legend");
      div.innerHTML = `
        <div style="font-weight:600; margin-bottom:4px;">สัญลักษณ์</div>
        <div class="row"><span class="dot red"></span> สาขา + รัศมี 80 กม.</div>
        <div class="row"><span class="dot blue"></span> Leads ทั่วไป</div>
        <div class="row"><span class="dot green"></span> Leads ที่ตรงกับ DBD</div>
      `;
      return div;
    };
    legend.addTo(map);
    L.control.scale({ metric: true, imperial: false }).addTo(map);
  </script>
</body>
</html>
